From 02781d178c901e7bb15143f64b221912905ef0e3 Mon Sep 17 00:00:00 2001
From: Richard Hughes <richard@hughsie.com>
Date: Thu, 19 Jan 2012 10:43:24 +0000
Subject: [PATCH] Don't segfault the client if there are no cached properties

Hopefully resolves http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=656376
---
 lib/packagekit-glib2/pk-client.c  |    2 +-
 lib/packagekit-glib2/pk-control.c |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/packagekit-glib2/pk-client.c b/lib/packagekit-glib2/pk-client.c
index f6d4026..19e3bfd 100644
--- a/lib/packagekit-glib2/pk-client.c
+++ b/lib/packagekit-glib2/pk-client.c
@@ -1426,7 +1426,7 @@ pk_client_proxy_connect (PkClientState *state)
 
 	/* coldplug properties */
 	props = g_dbus_proxy_get_cached_property_names (state->proxy);
-	for (i = 0; props[i] != NULL; i++) {
+	for (i = 0; props != NULL && props[i] != NULL; i++) {
 		value_tmp = g_dbus_proxy_get_cached_property (state->proxy,
 							      props[i]);
 		pk_client_set_property_value (state,
diff --git a/lib/packagekit-glib2/pk-control.c b/lib/packagekit-glib2/pk-control.c
index 3ae9d94..83c3c72 100644
--- a/lib/packagekit-glib2/pk-control.c
+++ b/lib/packagekit-glib2/pk-control.c
@@ -377,7 +377,7 @@ pk_control_proxy_connect (PkControlState *state)
 
 	/* coldplug properties */
 	props = g_dbus_proxy_get_cached_property_names (state->proxy);
-	for (i = 0; props[i] != NULL; i++) {
+	for (i = 0; props != NULL && props[i] != NULL; i++) {
 		value_tmp = g_dbus_proxy_get_cached_property (state->proxy,
 							      props[i]);
 		pk_control_set_property_value (state->control,
-- 
1.7.6

