From 9cfa48d5e135191062beb8d89dfe28b47c541ec5 Mon Sep 17 00:00:00 2001
From: Iain Lane <iain@orangesquash.org.uk>
Date: Fri, 30 Jun 2017 16:16:23 +0100
Subject: [PATCH 2/2] aptcc: Ignore -dbg for codec queries
Forwarded: https://github.com/hughsie/PackageKit/pull/199

---
 backends/aptcc/apt-intf.cpp    | 6 ++++++
 backends/aptcc/gst-matcher.cpp | 3 ++-
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/backends/aptcc/apt-intf.cpp b/backends/aptcc/apt-intf.cpp
index 19122e99c..db5acef2e 100644
--- a/backends/aptcc/apt-intf.cpp
+++ b/backends/aptcc/apt-intf.cpp
@@ -538,6 +538,12 @@ void AptIntf::providesCodec(PkgList &output, gchar **values)
             continue;
         }
 
+        // Ignore debug packages - these aren't interesting as codec providers,
+        // but they do have apt GStreamer-* metadata.
+        if (ends_with (pkg.Name(), "-dbg") || ends_with (pkg.Name(), "-dbgsym")) {
+            continue;
+        }
+
         // TODO search in updates packages
         // Ignore virtual packages
         pkgCache::VerIterator ver = m_cache->findVer(pkg);
diff --git a/backends/aptcc/gst-matcher.cpp b/backends/aptcc/gst-matcher.cpp
index 2cf1e256e..fd5a9cacf 100644
--- a/backends/aptcc/gst-matcher.cpp
+++ b/backends/aptcc/gst-matcher.cpp
@@ -19,6 +19,7 @@
  */
 
 #include "gst-matcher.h"
+#include "apt-utils.h"
 
 #include <regex.h>
 #include <gst/gst.h>
@@ -72,7 +73,7 @@ GstMatcher::GstMatcher(gchar **values)
                     // This is hardcoded in pk-gstreamer-install, so we also hardcode it here
                     const string x86_64 = "()(64bit";
 
-                    if (equal(x86_64.rbegin(), x86_64.rend(), opt.rbegin())) {
+                    if (ends_with(opt.c_str(), x86_64.c_str())) {
                             // We hardcode 64bit -> amd64 here
                             arch = "amd64";
                             // -1 -> remove the last )
-- 
2.11.0

