From 830af50b26d82d8ef077d6546a7e4edac83686c7 Mon Sep 17 00:00:00 2001
From: Matthias Klumpp <matthias@tenstral.net>
Date: Wed, 21 Oct 2020 16:25:53 +0200
Subject: [PATCH] aptcc: Drop apt-inst, use apt-pkg pkg-config file for
 dependency detection

---
 backends/aptcc/meson.build | 42 +++-----------------------------------
 1 file changed, 3 insertions(+), 39 deletions(-)

diff --git a/backends/aptcc/meson.build b/backends/aptcc/meson.build
index 0a9ce8b0d..2a6eae727 100644
--- a/backends/aptcc/meson.build
+++ b/backends/aptcc/meson.build
@@ -5,42 +5,8 @@ cpp_compiler = meson.get_compiler('cpp')
 gstreamer_dep = dependency('gstreamer-1.0')
 gstreamer_base_dep = dependency('gstreamer-base-1.0')
 gstreamer_plugins_base_dep = dependency('gstreamer-plugins-base-1.0')
-appstream_dep = dependency('appstream', version: '>=0.11')
-
-apt_pkg_dep = cpp_compiler.find_library('apt-pkg')
-apt_inst_dep = cpp_compiler.find_library('apt-inst')
-
-if not cpp_compiler.compiles(
-  '''
-    #include <apt-pkg/pkgsystem.h>
-    int main () {
-      _system->ArchitecturesSupported();
-      return 0;
-    }
-  ''',
-  dependencies: [
-    apt_pkg_dep,
-    apt_inst_dep
-  ]
-)
-  error ('libapt-pkg 1.1 or later is required')
-endif
-
-if not cpp_compiler.compiles(
-  '''
-    #include <apt-pkg/pkgsystem.h>
-    int main () {
-      _system->LockInner();
-      return 0;
-    }
-  ''',
-  dependencies: [
-    apt_pkg_dep,
-    apt_inst_dep
-  ]
-)
-  error ('libapt-pkg 1.7 or later is required - or backported frontend locking')
-endif
+appstream_dep = dependency('appstream', version: '>=0.12')
+apt_pkg_dep = dependency('apt-pkg', version: '>=1.9.2')
 
 # Check whether apt supports ddtp
 ddtp_flag = []
@@ -53,8 +19,7 @@ if cpp_compiler.compiles(
     }
   ''',
   dependencies: [
-    apt_pkg_dep,
-    apt_inst_dep
+    apt_pkg_dep
   ]
 )
   ddtp_flag = ['-DHAVE_DDTP']
@@ -86,7 +51,6 @@ shared_module(
     packagekit_glib2_dep,
     gmodule_dep,
     apt_pkg_dep,
-    apt_inst_dep,
     gstreamer_dep,
     gstreamer_base_dep,
     gstreamer_plugins_base_dep,
