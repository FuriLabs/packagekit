From c3eed50835846b0357693cceb1d4654713c30e94 Mon Sep 17 00:00:00 2001
From: Daniel Nicoletti <dantti12@gmail.com>
Date: Mon, 10 Dec 2012 15:56:23 -0200
Subject: [PATCH] aptcc: Fix bug that was marking some packages as auto-installed and confused the resolver

---
 backends/aptcc/apt-intf.cpp |   10 +---------
 1 files changed, 1 insertions(+), 9 deletions(-)

diff --git a/backends/aptcc/apt-intf.cpp b/backends/aptcc/apt-intf.cpp
index cb1bf88..a66ed3f 100644
--- a/backends/aptcc/apt-intf.cpp
+++ b/backends/aptcc/apt-intf.cpp
@@ -1479,7 +1479,6 @@ void AptIntf::tryToRemove(const pkgCache::VerIterator &ver,
     Cache.MarkDelete(Pkg, false);
 }
 
-
 bool AptIntf::tryToInstall(const pkgCache::VerIterator &ver,
                            pkgDepCache &Cache,
                            pkgProblemResolver &Fix,
@@ -1489,6 +1488,7 @@ bool AptIntf::tryToInstall(const pkgCache::VerIterator &ver,
     pkgCache::PkgIterator Pkg = ver.ParentPkg();
 
     // Check if there is something at all to install
+    Cache.SetCandidateVersion(ver);
     pkgDepCache::StateCache &State = Cache[Pkg];
 
     if (State.CandidateVer == 0) {
@@ -1511,14 +1511,6 @@ bool AptIntf::tryToInstall(const pkgCache::VerIterator &ver,
         ExpectedInst++;
     }
 
-    // 	cout << "trytoinstall ExpectedInst " << ExpectedInst << endl;
-    // Install it with autoinstalling enabled (if we not respect the minial
-    // required deps or the policy)
-    if ((State.InstBroken() == true || State.InstPolicyBroken() == true) &&
-            BrokenFix == false) {
-        Cache.MarkInstall(Pkg,true);
-    }
-
     return true;
 }
 
-- 
1.7.1

